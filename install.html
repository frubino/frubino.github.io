
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Installation &#8212; MGKit: Metagenomic framework 0.5.7 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Metagenomic Pipeline" href="pipeline/index.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="installation">
<span id="install-ref"></span><h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>The library is both in <a class="reference external" href="https/www.pypi.org">PyPI</a> and <a class="reference external" href="https://bioconda.github.io">Bioconda</a>. Any new version is first released on PyPI and then ported to the Bioconda repository. Installation is easier from Bioconda, since some dependencies (specifically <a class="reference external" href="https://github.com/pysam-developers/pysam">pysam</a>) can have requirements that are difficult to resolve.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The preferred version of Python to use is &gt;=3.5 as this is the one I’m using MGKit with and Python 2.7 will not be mantained anymore starting with 1st January 2020. From MGKit 0.3.4 support for Python 3 was added and from 0.4.x you can expect Python 2.7 supoort to be gradually removed.</p>
</div>
<div class="section" id="using-conda">
<h2>Using Conda<a class="headerlink" href="#using-conda" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>this was tested in conda version 4.5.4 and Python 3.6.5</p>
</div>
<p>Installing in a conda environment is relatively straight forward, and I recommend installing mgkit in its own environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ conda create --name mgkit mgkit
</pre></div>
</div>
<p>This will install <cite>mgkit</cite> in a virtual environment called <cite>mgkit</cite>. Conda will write on screen the way to activate the virtual environment, which may different according to your installation.</p>
</div>
<div class="section" id="docker-instance-with-jupyter-notebook">
<h2>Docker Instance (with Jupyter Notebook)<a class="headerlink" href="#docker-instance-with-jupyter-notebook" title="Permalink to this headline">¶</a></h2>
<p>A preconfigured Docker instance (user: mgkit, no password) has been configured at <a class="reference external" href="https://hub.docker.com/r/frubino/mgkit/">Docker Hub</a>, including more packages for testing, available at Docker Hub (frubino/mgkit), with more instruction on its use available there. The version of MGKit targeted is the last development branch, but can be customised using the files available at <a class="reference external" href="https://github.com/frubino/mgkit-docker-repo">github</a>, specifically in the <cite>bootstrap.sh</cite> file.</p>
</div>
<div class="section" id="pip-and-pipenv">
<h2>Pip and pipenv<a class="headerlink" href="#pip-and-pipenv" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://pipenv.readthedocs.io/">pipenv</a> is the environment I use for developing and test, <cite>conda</cite> should be preferred for end users.</p>
<p>As of version 0.4.0, only python &gt;=3.5 is used. The library has been ported to Python 3 (tested under version 3.5 and laters), but a layer of compatibility with Python 2.7 is used (the <strong>future</strong> package). Forward, version 0.3.4 is the last one that targets primarly Python 2.7 (but is partially compatible with Python 3). To test the version of Python installed use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python --version
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>when installing pysam from source, the compilation of its libraries need system packages installed. Read the <a class="reference external" href="https://github.com/pysam-developers/pysam/blob/master/htslib/INSTALL">INSTALL</a> file to help you install the library</p>
</div>
<p>Assuming you have installed the required packages for <cite>pysam</cite> and other dependencies, <cite>pipenv</cite> can be used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pipenv install mgkit
</pre></div>
</div>
<p>and the environment activated with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pipenv shell
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><cite>enum34</cite> is installed with Python version &lt; 3.4</p>
</div>
<p>To recreate the <cite>.c</cite> files for the <cite>mgkit.io.utils.sequences</cite>, set the environment variable USE_CYTHON:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export USE_CYTHON=TRUE
</pre></div>
</div>
<p>and then:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py build
</pre></div>
</div>
<div class="section" id="using-the-repository">
<h3>Using the repository<a class="headerlink" href="#using-the-repository" title="Permalink to this headline">¶</a></h3>
<p>The source code can also be obtained from the <a class="reference external" href="https://bitbucket.org/setsuna80/mgkit">Bitbucket repository</a>.</p>
</div>
</div>
<div class="section" id="running-tests">
<h2>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>Tests are performed with <a class="reference external" href="https://tox.readthedocs.io/en/latest/">tox</a>, which you can use to run tests on specific versions of the interpreter. You can look at <cite>tox.ini</cite> in the distribution for the version tested.</p>
<p>The tests requires the <cite>pytest</cite> package and some plugins (<cite>pytest-datadir</cite> and <cite>pytest-console-scripts</cite>):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip install pytest pytest-datadir pytest-console-scripts
</pre></div>
</div>
<p>You can run the tests with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python setup.py test
</pre></div>
</div>
<p>Some test won’t be run if the required library/data is not found. Consult the output for more information.</p>
</div>
<div class="section" id="building-documentation">
<h2>Building Documentation<a class="headerlink" href="#building-documentation" title="Permalink to this headline">¶</a></h2>
<p>The requirements are detailed in <cite>docs_req.txt</cite> of the repository. Other libraries:</p>
<ul class="simple">
<li><p>latex (for pdf output - <cite>make latexpdf</cite>)</p></li>
<li><p>pandoc</p></li>
</ul>
</div>
<div class="section" id="troubleshooting-for-older-versions">
<h2>Troubleshooting (for older versions)<a class="headerlink" href="#troubleshooting-for-older-versions" title="Permalink to this headline">¶</a></h2>
<p>Some of the dependencies require available compilers to finish the installation. At the mimimum a system that provides the full GNU compiler suite, including a fortran compiler is required to install those dependencies by source.</p>
<p>If a compilation error is raised during installation, it’s adviced to install each dependency manually. I’ll try to keep this section updated, but there’s not that many OS that I can keep working on (mostly MacOSX and GNU/Linux).</p>
<div class="section" id="older-versions-of-macosx">
<h3>Older versions of MacOSX<a class="headerlink" href="#older-versions-of-macosx" title="Permalink to this headline">¶</a></h3>
<p>Version 10.19 of MacOSX comes with Python 2.7 installed. To install every dependency from source, however it’s needed to install the <em>Xcode</em> app from the <strong>App Store</strong> which install the compilers, with the exception of <cite>gfortran</cite>. Another solution is using <a class="reference external" href="http://brew.sh">Homebrew</a> or <a class="reference external" href="http://www.macports.org">Macports</a>, to install the compilers needed.</p>
<p>If you want to use Xcode, you need to install the gfortran compiler, with the package provided <a class="reference external" href="http://gcc.gnu.org/wiki/GFortranBinariesMacOS">here</a>. This should be enough to install most packages from source.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There seems to be a problem with <cite>pandas</cite> version 0.13.1 on MacOSX, with a segmentation fault happening when using DataFrames. The 0.14.1 version is the one tested.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>if there’s a problem building a python package because of a compile error, dealing with an unknown command line option, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">ARCHFLAGS</span><span class="o">=-</span><span class="n">Wno</span><span class="o">-</span><span class="n">error</span><span class="o">=</span><span class="n">unused</span><span class="o">-</span><span class="n">command</span><span class="o">-</span><span class="n">line</span><span class="o">-</span><span class="n">argument</span><span class="o">-</span><span class="n">hard</span><span class="o">-</span><span class="n">error</span><span class="o">-</span><span class="ow">in</span><span class="o">-</span><span class="n">future</span>
</pre></div>
</div>
<p>It’s related to the clang toolchain included with Xcode</p>
</div>
<div class="section" id="matplotlib">
<h4>Matplotlib<a class="headerlink" href="#matplotlib" title="Permalink to this headline">¶</a></h4>
<p>The tricky package to install in MacOSX is actually <a class="reference external" href="http://matplotlib.org">matplotlib</a>, with one of many solutions being posted on <a class="reference external" href="http://stackoverflow.com/questions/4092994/unable-to-install-matplotlib-on-mac-os-x">a disccusion on stackoverflow</a>. In our case, installing <cite>freetype2</cite> and <cite>libpng</cite> through Homebrew it’s the less painful:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ brew install libpng freetype2
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you get a compilation error which refers to freetype2 in the <cite>/opt/X11/</cite> I found it easy to delete XQuartz installing matplotlib and then reinstall XQuartz.</p>
<p>Or use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">PKG_CONFIG_PATH</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Cellar</span><span class="o">/</span><span class="n">freetype</span><span class="o">/</span><span class="mf">2.6_1</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span><span class="p">:</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">Cellar</span><span class="o">/</span><span class="n">libpng</span><span class="o">/</span><span class="mf">1.6</span><span class="o">.</span><span class="mi">19</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">pkgconfig</span><span class="o">/</span>
</pre></div>
</div>
<p>Note that the versions may be different.</p>
</div>
</div>
</div>
<div class="section" id="installing-scipy-from-source-on-linux">
<h3>Installing Scipy from source on Linux<a class="headerlink" href="#installing-scipy-from-source-on-linux" title="Permalink to this headline">¶</a></h3>
<p>A full description on how to install the scipy on Linux from source can be found at <a class="reference external" href="http://www.scipy.org/scipylib/building/linux.html">this address</a>, be aware that the compilation of the <cite>math-atlas</cite> and <cite>lapack</cite> libraries takes a long time.</p>
<p>Installation in a virtual environment:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># create virtual environment, if needed, otherwise activate the one desired
virtualenv venv
source venv/bin/activate
# create temporary directory to compile math-atlas and lapack
mkdir dep-build; cd dep-build
wget http://www.netlib.org/lapack/lapack.tgz
wget http://sourceforge.net/projects/math-atlas/files/Stable/3.10.2/atlas3.10.2.tar.bz2/download
tar xfvj download
cd ATLAS
mkdir build; cd build
../configure -Fa alg -fPIC --with-netlib-lapack-tarfile=../../lapack.tgz --prefix=$VIRTUAL_ENV
make
cd lib; make shared; make ptshared; cd ..
make install
</pre></div>
</div>
<p>This will compile math-atlas with full lapack support in the virtual environment; change the <cite>–prefix=$VIRTUAL_ENV</cite> to <cite>–prefix=$HOME</cite> if you want to install the dependencies in you home directory.</p>
</div>
</div>
<div class="section" id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this headline">¶</a></h2>
<p>Not all packages are required to use the part of the library, but it’s
recommended to install all of them. Requirements are bound to change, but pandas, scipy,
numpy, pysam and matplotlib are the bases of the library.</p>
<p>To avoid problems with the system installation, I suggest using the excellent
<a class="reference external" href="http://www.virtualenv.org/">virtualenv</a>. This will avoid problems with
installing packages system-wide and breaking a working installation.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets">1</span></dt>
<dd><p><a class="reference external" href="http://www.pip-installer.org/en/latest/user_guide.html#user-installs">http://www.pip-installer.org/en/latest/user_guide.html#user-installs</a></p>
</dd>
</dl>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">MGKit: Metagenomic framework</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#using-conda">Using Conda</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-instance-with-jupyter-notebook">Docker Instance (with Jupyter Notebook)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pip-and-pipenv">Pip and pipenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-tests">Running Tests</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-documentation">Building Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#troubleshooting-for-older-versions">Troubleshooting (for older versions)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pipeline/index.html">Metagenomic Pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="scripts/index.html">Scripts Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="gff.html">MGKit GFF Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="library.html">Library Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changes</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="introduction.html" title="previous chapter">Introduction</a></li>
      <li>Next: <a href="pipeline/index.html" title="next chapter">Metagenomic Pipeline</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2013-2020, Francesco Rubino.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.2.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/install.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>